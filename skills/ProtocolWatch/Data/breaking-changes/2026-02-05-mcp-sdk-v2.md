# Protocol Alert: MCP TypeScript SDK v2 (Pre-Alpha)

**Severity:** HIGH
**Protocol:** MCP TypeScript SDK
**Change:** SDK v2 rewrite on main branch (pre-alpha)
**Detected:** 2026-02-05

## What Changed in v2 (Pre-Alpha, NOT yet released)

Major breaking changes discovered in main branch migration guide:

### 1. Package Rename
- `@modelcontextprotocol/sdk` splits into 3 packages:
  - `@modelcontextprotocol/server`
  - `@modelcontextprotocol/client`
  - `@modelcontextprotocol/core`

### 2. String-Based Method Names
```typescript
// v1
server.setRequestHandler(CallToolRequestSchema, async (request, extra) => {...});
// v2
server.setRequestHandler('tools/call', async (request, ctx) => {...});
```

### 3. Context Parameter Restructured
- `extra` parameter → `ctx` with nested groups:
  - `ctx.mcpReq` -- request-level (id, method, signal, send, notify)
  - `ctx.http?` -- HTTP transport (authInfo, req, closeSSE)
  - `ctx.task?` -- task lifecycle (id, store, requestedTtl)

### 4. Error Hierarchy Refactored
- `McpError` → `ProtocolError` (crosses the wire)
- New `SdkError` (local errors, never crosses wire)
- `ErrorCode` → `ProtocolErrorCode` + `SdkErrorCode`
- `StreamableHTTPError` removed

### 5. OAuth Error Consolidation
- 17 individual error classes → single `OAuthError` with `OAuthErrorCode` enum

### 6. Type Renames
| v1 | v2 |
|----|-----|
| `JSONRPCError` | `JSONRPCErrorResponse` |
| `ResourceReference` | `ResourceTemplateReference` |
| `IsomorphicHeaders` | Use Web Standard `Headers` |

## PAI Impact

- **Affects:** All MCP server implementations in PAI
- **When:** v2 is pre-alpha, NOT imminent. Monitor for RC announcement.
- **Migration effort:** Medium (substantial API changes)
- **Action now:** No action needed. Track for future migration planning.

## v1.26.0 (Current Stable - Released Feb 4, 2026)

Critical security fix:
- **GHSA-345p-7cg4-v4c7 / CVE-2026-25536**: Cross-client response data leak
  - Race condition in shared StreamableHTTPServerTransport
  - Affects v1.10.0 through v1.25.3
  - CVSS 7.1 (HIGH)
  - **Fixed in v1.26.0**
- Client Credentials provider scopes support
- npm audit vulnerability fixes
